!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios"),require("parsleyjs")):"function"==typeof define&&define.amd?define(["exports","axios","parsleyjs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).owlyWebflow={},e.axios,e.parsley)}(this,(function(e,t,o){"use strict";const r=function(e){let{baseURL:o,headers:r={},endpoints:n={},timeout:a=3e4}=e;const i=t.create({baseURL:o,headers:r,timeout:a}),l={};return Object.entries(n).forEach((e=>{let[t,o]=e;const{url:r,method:n}=o;l[t]=function(){let{urlParams:e,config:t={},data:o={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=e.match(/\{([a-zA-Z0-9_]+)}/g);if(o){let r=e;return o.forEach((e=>{const o=e.replace(/{?}?/g,"");r=r.replace(e,t[o]||"")})),r}return e}(r,e);return["get","delete","head","options"].includes(n)?i[n](a,t):i[n](a,o,t)}})),l}({baseURL:"https://api.owly.com.co",endpoints:{getProject:{method:"get",url:"/projects/{projectId}"},getProjectTower:{method:"get",url:"/projects/{projectId}/{towerId}"},createLead:{method:"post",url:"/leads/"}}});const n=e=>e.serializeArray().reduce(((e,t)=>{let{name:o,value:r}=t;return{...e,[o]:r}}),{});function a(e){const t=e.$element,o=t.find("button[type=submit]"),a=t.find("div[role=alert]");return o.prop("disabled",!0),r.createLead({data:n(t)}).then((()=>{o.prop("disabled",!1),t.trigger("reset"),a.removeClass("d-none"),setTimeout((()=>a.addClass("d-none")),5e3),e.reset()})),!1}const i="sold",l=(e,t)=>{let o;return e.every((e=>e.available===i))?e.forEach(((e,r)=>{0===r&&(o=e[t]),e[t]<o&&(o=e[t])})):e.forEach((e=>{e.available===i||o||(o=e[t]),e.available!==i&&e[t]<=o&&(o=e[t])})),`${function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e=new Intl.NumberFormat("es-ES").format(parseFloat(e).toFixed(t)),t>0){const o=e.indexOf(",")>-1?e.length-1-e.indexOf(","):0;e=0==o?e+","+"0".repeat(t):e+"0".repeat(t-o)}return e}(o)}`},s=(e,t)=>{let o,r;return e.every((e=>e.available===i))?e.forEach(((e,n)=>{0===n&&(o=e[t],r=e[t]),e[t]<o&&(o=e[t]),e[t]>r&&(r=e[t])})):e.forEach((e=>{e.available===i||o||(o=e[t]),e.available===i||r||(r=e[t]),e.available!==i&&e[t]<o&&(o=e[t]),e.available!==i&&e[t]>r&&(r=e[t])})),o===r?`${r} m²`:`${o} a ${r} m²`},c=(e,t)=>{let o=[];if(e.every((e=>e.available===i))?e.forEach(((e,r)=>{0===r&&o.push(e[t]),o.includes(e[t])||o.push(e[t])})):e.forEach(((e,r)=>{e.available===i||o.includes(e[t])||o.push(e[t])})),1===o.length)return o[0];o.sort(((e,t)=>e-t));const r=o.pop();return o.join(", ")+" y "+r};e.getProjectAvailability=async function(e){var t;const{product:o,companyCode:n,projectId:a,token:i,itemCallback:l,limit:s=400}=e,{status:c,data:d}=await r.getProject({config:{params:{product:o,companyCode:n,limit:s,token:i}},urlParams:{projectId:a}}),{project:u}=d;200===c&&null!==(t=u.units)&&void 0!==t&&t.length&&u.units.forEach((e=>{l&&"function"==typeof l&&l(e)}))},e.getVecindario=async function(e){const{projectId:t,BASE_QUOTER_ID:o,towerId:n,typologies:a={},root:i}=e;try{const{status:e,data:{project:{tower:{units:p}}}}=await r.getProjectTower({config:{params:{product:"vecindario"}},urlParams:{projectId:t,towerId:n}}),m=window.location.pathname;if("/"===m||m===i||m===i+"/"||m===`${i}/index.html`){const{status:o,data:{project:{towers:n}}}=await r.getProject({config:{params:{product:"vecindario"}},urlParams:{projectId:t}});if(200===o){const e=document.getElementById("tower-type"),t=document.getElementById("total-towers"),o=document.getElementById("deadline");e&&(e.innerHTML=(e=>{if(e.includes("_")){const t=e.split("_");return t.forEach(((e,t,o)=>{o[t]=e[0].toUpperCase()+e.slice(1)})),t.join(" ")}return"Proyecto "+e[0].toUpperCase()+e.slice(1)})(n[0].towerType)),t&&(t.innerHTML=n.length),o&&(o.innerHTML=(e=>{const[t,o]=e.split("-");return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][o-1]} de ${t}`})(n[0].deadline))}if(200===e){const e=document.getElementById("total-properties"),t=document.getElementById("minimum-price"),o=document.getElementById("areas"),r=document.getElementById("bedrooms"),n=document.getElementById("bathrooms");e&&(e.innerHTML=p.length),t&&(t.innerHTML=l(p,"finalPrice")),o&&(o.innerHTML=s(p,"builtArea")),r&&(r.innerHTML=c(p,"bedrooms")),n&&(n.innerHTML=c(p,"bathrooms"))}}else{var d,u;let f=0;i&&(f=i.split("/").length-1);let y=m.split("/")[2+f],h=m.split("/")[3+f];if(null!==(d=y)&&void 0!==d&&d.includes(".html")&&(y=y.split(".html")[0]),null!==(u=h)&&void 0!==u&&u.includes(".html")&&(h=h.split(".html")[0]),y&&200===e){const[e,t]=y.split("-");if("tipo"===e){const e=document.getElementById("type-name"),o=document.getElementById("type-min-price"),r=document.getElementById("built-area"),n=document.getElementById("private-area"),a=document.getElementById("type-bedrooms"),i=document.getElementById("type-bathrooms"),d=[];p.forEach((e=>{e.type.toUpperCase()===t.toUpperCase()&&d.push(e)})),e&&d.length&&(e.innerHTML=`Tipo ${d[0].type}`),o&&(o.innerHTML=l(d,"finalPrice")),r&&(r.innerHTML=s(d,"builtArea")),n&&(n.innerHTML=s(d,"privateArea")),a&&(a.innerHTML=c(d,"bedrooms")),i&&(i.innerHTML=c(d,"bathrooms"))}}if(h&&200===e){const[e,i]=h.split("-");if("etapa"===e){const e=document.querySelectorAll('[class~="floor-mask"]');e&&e.forEach((e=>{for(let t=0;t<e.classList.length;t++){const o=e.classList[t];if(o.includes("piso")){const t=o.split("-")[1],r=p.filter((e=>e.floor.toString()===t.toString()));let n=0;r.forEach((e=>{"sold"!==e.available&&(n+=1)}));const a=e.querySelector(".fs7--fw2--fcoa");a&&(a.innerHTML=`Piso ${t}`);const i=e.querySelector(".fs7-2--fcoa");if(i&&(i.innerHTML=`${n} de ${r.length}`),0===n){const t=e.querySelector(".availability-dot");t&&t.classList.add("danger")}}}}))}if("floor"===e){if(!Object.keys(a).length){const{status:e,data:{project:{tower:{types:o}}}}=await r.getProjectTower({config:{params:{product:"vecindario",typologies:"true"}},urlParams:{projectId:t,towerId:n}});200===e&&o.forEach((e=>{a[e.type]=e.id}))}p.sort(((e,t)=>e.name>t.name?1:e.name<t.name?-1:0));const e=[];p.forEach((t=>{t.floor.toString()===i.toString()&&e.push(t)})),e.forEach(((e,t)=>{const r=document.getElementById(e.id);if(r)for(let t=0;t<r.children.length;t++){const i=r.children[t];if("html-typology w-embed"===i.className&&"sold"===e.available&&i.classList.add("danger"),"tooltip-typology--bbc1--br1"===i.className){const t=i.children;for(let o=0;o<t.length;o++)"availability-dot"===t[o].className&&"sold"===e.available&&t[o].classList.add("danger"),"fs7-2--fw3--fc1"===t[o].className&&(t[o].innerHTML=e.name)}if("tooltip-unit-detail bbc1--br2"===i.className||"tooltip-unit-detail bbc1--br2 show"===i.className){const t=i.querySelector(".fs7-2--fc2");t&&"sold"===e.available&&(t.innerHTML="Vendido");const l=i.querySelector(".availability-dot");t&&"sold"===e.available&&l.classList.add("danger");const d=i.querySelector(".fs6--fw3--fc1");d&&(d.innerHTML=e.name);const u=i.querySelectorAll(".button_main_text");u.length>0&&(u[0].innerHTML=s([e],"builtArea"),u[1].innerHTML=c([e],"bedrooms"),u[2].innerHTML=c([e],"bathrooms"));const p=i.querySelector(".tooltip-buttons");if(p)if("sold"===e.available)p.classList.add("hide");else{const t=p.children[1],i=r.querySelector(".quoter--bbc1"),l=i.querySelector(".quoter-iframe").children[0],s=`https://cotizador.vecindariosuite.com/proyecto/owly-demo/cotizar/${o}/?towerId=${n}&typologyId=${a[e.type]}&propertyId=${e.id}`;t.addEventListener("click",(function(t){t.preventDefault(),l&&a[e.type]&&(l.setAttribute("src",s),i.classList.contains("show")?i.classList.remove("show"):i.classList.add("show"))}))}}}}))}}}}catch(e){console.log(e)}},e.initForm=async function(e){new o.Factory(e,{errorClass:"is-invalid",successClass:"is-valid",errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"}).on("form:submit",a)}}));
